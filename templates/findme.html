{% extends "layout.html" %} 
{% import "bootstrap/wtf.html" as wtf %} 

{% block title %}
{{ super()}}
- Find Me
{% endblock %} 

{% block page_content %}
{{ super() }}


<div class="container">
	
	<div class="col-md-12">
		

		</br>

		<div class="row">
			<div class="col-md-12 panel panel-success">
				<div class="panel-heading">
					<h3 class="panel-title">Your Current IP Location</h3>
				</div>
				<div class="panel-body text-center">
			        {% for category, message in get_flashed_messages(with_categories=true) %} 
			        <div class="alert alert-{{ category }}">
			        	<button type="button" class="close" data-dismiss="alert">&times;</button>
			        	{{ message }}
			        </div>
			        {% endfor %}
			        <div id="map-container">
			        	
			        </div>
			    </div>
			</div>
		</div>

		
		
	</div>
</div>

</div>



{% endblock %}

{% block scripts %}
{{ super() }}
<script type="text/javascript" src="//maps.googleapis.com/maps/api/js?key=AIzaSyA0C2Xi_cPKItEbSokdY-pwmOJCvXfGqik"></script>
<script type="text/javascript" src="/static/markerwithlabel_packed.js"></script>

<script type="text/javascript">

$(document).ready(function(){
	
	$('#map-container').css('height', '450px');

	function initialize_map(latitude, longitude, titleText) {
		var myLatlng = new google.maps.LatLng(latitude, longitude);

		var mapOptions = {
			center: myLatlng,
			zoom: 5
		};

		var map = new google.maps.Map(document.getElementById('map-container'), mapOptions);

		var marker = new MarkerWithLabel({
		    position: myLatlng,
		    map: map,
		    title: titleText,
		    labelContent: titleText,
       		labelAnchor: new google.maps.Point(-15, 30),
		    labelClass: "marker-label",
		    animation: google.maps.Animation.DROP
		});
	}

	$.ajax({
		type : "GET",
		url : "http://icanhazip.com",
		success : function(resp){
			$.ajax({
				type : "GET",
				url : "/geoip/" + resp,
				contentType: 'application/json;charset=UTF-8',
				beforeSend: function(){
					$('.gm-style').remove();
				},
				success : function(resp){
					initialize_map(resp['Latitude'], resp['Longitude'], resp['Domain Name']);
				},
			})
		},
		error : function(resp){
			alert(resp);
		}
	});



	

	

	
});

</script>

{% endblock %}